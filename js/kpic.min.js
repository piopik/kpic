function kpic(){var c=$('<div id="kpic"><div class="pic"><a class="close"></a><div class="number"><span class="a"></span> / <span class="b"></span></div><div class="black"><a class="arr left"></a><a class="arr right"></a><div class="title"></div></div></div></div>');c.appendTo("body");var b=c.find(".pic");kpic=[];var a={};a.w=$(window).width();a.h=window.innerHeight;$(".kpic").each(function(){$(this).off("click");pic={href:$(this).attr("href"),title:$(this).attr("title")};if($(this).attr("data-kgallery")){gal=$(this).attr("data-kgallery")}else{gal=0}if(!kpic[gal]){kpic[gal]=[]}$(this).attr("data-kid",kpic[gal].push(pic)-1)});var d=[];function e(h,g){if(kpic[g][h]&&h>=0){c.addClass("loading");var f=new Image();f.src=kpic[g][h].href;f.title=kpic[g][h].title;d.id=h;d.gal=g;b.find(".number .a").html(d.id+1);b.find(".number .b").html(kpic[g].length);f.onload=function(){width=Math.min(this.width,0.9*a.w);height=Math.min(this.height,0.9*a.h);b.css({width:width,height:height}).css({"margin-left":-width/2,"margin-top":-height/2,background:"url("+this.src+")"});b.find(".title").html(f.title);c.removeClass("loading");b.find(".arr").unbind();b.find(".left").bind("click",function(){e((d.id-1),d.gal)});b.find(".right").bind("click",function(){e((d.id+1),d.gal)});$(document).unbind("keyup");$(document).keyup(function(i){if(i.keyCode==27){c.removeClass("show");b.find(".title").html("")}else{if(i.keyCode==37){e((d.id-1),d.gal)}else{if(i.keyCode==39){e((d.id+1),d.gal)}}}})}}}$(".kpic").on("click",function(g){g.preventDefault();a.w=$(window).width();a.h=window.innerHeight;c.addClass("loading");var f=new Image();f.src=$(this).attr("href");f.title=$(this).attr("title");d.id=$(this).data("kid");d.gal=$(this).data("kgallery");b.find(".number .a").html(d.id+1);b.find(".number .b").html(kpic[gal].length);f.onload=function(){width=Math.min(this.width,0.9*a.w);height=Math.min(this.height,0.9*a.h);b.css({width:width,height:height}).css({"margin-left":-width/2,"margin-top":-height/2,background:"url("+this.src+")"});b.find(".title").html(f.title);c.removeClass("loading");$(document).unbind("keyup");b.find(".arr").unbind();b.find(".left").bind("click",function(){e((d.id-1),d.gal)});b.find(".right").bind("click",function(){e((d.id+1),d.gal)});$(document).keyup(function(h){if(h.keyCode==27){c.removeClass("show");b.find(".title").html("")}else{if(h.keyCode==37){e((d.id-1),d.gal)}else{if(h.keyCode==39){e((d.id+1),d.gal)}}}})};c.addClass("show")});c.find(".close").on("click",function(f){if($(f.target).is(".pic")){f.preventDefault();return}c.removeClass("show");b.find(".title").html("");b.css({background:"rgba(255,255,255,0.1)"})})};